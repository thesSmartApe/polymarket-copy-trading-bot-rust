# 配置指南

所有机器人配置选项的完整参考。

## 目录

1. [必需设置](#1-必需设置)
2. [交易设置](#2-交易设置)
3. [风险管理设置（熔断器）](#3-风险管理设置熔断器)
4. [高级设置](#4-高级设置)
5. [配置示例](#5-配置示例)
6. [验证](#6-验证)
7. [配置故障排除](#7-配置故障排除)

---

## 1. 必需设置

这些必须设置才能使机器人工作。没有这些，机器人将无法启动。

### 1.1 PRIVATE_KEY

**类型：** 字符串（64 个十六进制字符）  
**格式：** 无 `0x` 前缀  
**示例：** `0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef`

您钱包的私钥。用于签署交易。

**⚠️ 安全警告：**
- 永远不要与任何人分享
- 永远不要提交到 git（`.env` 已在 `.gitignore` 中）
- 安全存储（推荐使用密码管理器）
- 为机器人交易使用单独的钱包（不是您的主钱包）

**如何获取：**
- MetaMask：账户详情 → 导出私钥
- 其他钱包：查看钱包文档了解导出方法

---

### 1.2 FUNDER_ADDRESS

**类型：** 字符串（40 个十六进制字符）  
**格式：** 可以包含或排除 `0x` 前缀  
**示例：** `0x1234567890123456789012345678901234567890` 或 `1234567890123456789012345678901234567890`

您的钱包地址。必须与 `PRIVATE_KEY` 的钱包匹配。

**如何获取：**
- MetaMask：从账户复制地址（扩展顶部）
- 其他钱包：通常在钱包 UI 中显著显示

**重要提示：** 确保此钱包有：
- Polygon 上的 USDC 或 USDC.e 代币
- 足够的 MATIC 用于 gas 费用（通常 0.01-0.1 MATIC 足够）

---

### 1.3 TARGET_WHALE_ADDRESS

**类型：** 字符串（40 个十六进制字符）  
**格式：** 无 `0x` 前缀  
**示例：** `204f72f35326db932158cba6adff0b9a1da95e14`

您想要复制的交易者的钱包地址。

**查找鲸鱼：**
- Polymarket 排行榜
- 大市场的最近赢家
- 社交媒体/社区

**验证：**
- 检查他们的交易历史
- 寻找一致的表现
- 从小额开始测试

---

### 1.4 ALCHEMY_API_KEY（或 CHAINSTACK_API_KEY）

**类型：** 字符串  
**示例：** `abc123xyz789def456`

**选择一个提供商：**

##### 1.4.1 选项 1：Alchemy（推荐）

**设置：** `ALCHEMY_API_KEY`

**获取 API 密钥：**
1. 在 https://www.alchemy.com/ 注册
2. 创建应用（Polygon Mainnet）
3. 从仪表板复制 API 密钥

**免费套餐：** 每月 300M 计算单位（对此机器人足够）

##### 1.4.2 选项 2：Chainstack

**设置：** `CHAINSTACK_API_KEY`

**获取 API 密钥：**
1. 在 https://chainstack.com/ 注册
2. 创建项目和 Polygon 节点
3. 从 WebSocket URL 中提取密钥

**注意：** 如果两者都设置了，`ALCHEMY_API_KEY` 优先。

---

## 2. 交易设置

### 2.1 ENABLE_TRADING

**类型：** 布尔值  
**默认值：** `true`  
**值：** `true`、`false`、`1`、`0`（不区分大小写）

机器人是否应该实际下单。

- `true` / `1`：机器人下真实订单
- `false` / `0`：机器人仅监控（不下单）

**推荐：** 初始测试时设置为 `false`。

---

### 2.2 MOCK_TRADING

**类型：** 布尔值  
**默认值：** `false`  
**值：** `true`、`false`、`1`、`0`（不区分大小写）

模拟交易而不实际执行。用于测试。

- `true` / `1`：显示机器人会做什么（无真实订单）
- `false` / `0`：真实交易模式

**推荐：** 首次运行时设置为 `true` 以验证一切正常。

**注意：** 如果 `ENABLE_TRADING=false`，`MOCK_TRADING` 无效。

---

## 3. 风险管理设置（熔断器）

熔断器保护您免受在危险市场条件下（低流动性、操纵等）复制交易。

### 3.1 CB_LARGE_TRADE_SHARES

**类型：** 浮点数  
**默认值：** `1500.0`  
**单位：** 股数

触发熔断器分析的最小交易规模。低于此规模的交易跳过熔断器检查（小交易执行更快）。

**建议：** 默认值通常可以。如果您想要更多保护，请增加；如果您想要中等交易的更快执行，请减少。

---

### 3.2 CB_CONSECUTIVE_TRIGGER

**类型：** 整数  
**默认值：** `2`  
**范围：** 1-10

触发熔断器订单簿深度检查的连续大额交易数量（在时间窗口内）。

**示例：** 使用默认值 `2`，如果在 `CB_SEQUENCE_WINDOW_SECS` 内发生 2 个或更多大额交易，机器人在复制之前检查订单簿深度。

**建议：**
- `1` = 最保守（检查每个大额交易）
- `2` = 平衡（默认）
- `3+` = 更激进（仅在多次大额交易后检查）

---

### 3.3 CB_SEQUENCE_WINDOW_SECS

**类型：** 整数  
**默认值：** `30`  
**单位：** 秒  
**范围：** 10-300

检查连续大额交易的时间窗口。

**示例：** 使用默认值 `30`，机器人回顾 30 秒以计算连续大额交易。

**建议：**
- `10-20` = 更敏感（快速检测快速序列）
- `30` = 平衡（默认）
- `60+` = 不太敏感（仅在较长序列时触发）

---

### 3.4 CB_MIN_DEPTH_USD

**类型：** 浮点数  
**默认值：** `200.0`  
**单位：** 美元

鲸鱼价格之外所需的最小订单簿深度（流动性）。如果深度较低，熔断器会阻止交易。

**含义：** 当您想以 $0.50 买入时，这会检查在价格高达 $0.51（鲸鱼价格 + 缓冲）时是否有至少 $200 的卖单可用。

**建议：**
- `100.0` = 不太保守（允许在较薄的市场中交易）
- `200.0` = 平衡（默认）
- `500.0+` = 非常保守（仅在流动性市场中交易）

---

### 3.5 CB_TRIP_DURATION_SECS

**类型：** 整数  
**默认值：** `120`  
**单位：** 秒  
**范围：** 30-600

熔断器触发后阻止交易的时间。

**含义：** 如果熔断器检测到危险条件，它会在此时长内停止复制交易。

**建议：**
- `60` = 快速恢复（更快恢复交易）
- `120` = 平衡（默认，2 分钟）
- `300+` = 非常保守（触发后等待 5+ 分钟）

---

## 4. 高级设置

这些在代码中设置，但可以通过编辑 `src/settings.rs` 进行修改。只有在您了解自己在做什么时才更改。

### 交易参数（在代码中）

**位置：** `src/config.rs`

- `SCALING_RATIO`（默认：`0.02` = 2%）
  - 您的仓位大小作为鲸鱼大小的分数
  - `0.01` = 1%，`0.05` = 5%，等等

- `MIN_WHALE_SHARES_TO_COPY`（默认：`10.0`）
  - 要复制的最小鲸鱼交易规模
  - 低于此的交易被忽略

- `MIN_CASH_VALUE`（默认：`1.01`）
  - 您订单的最小美元价值
  - 防止灰尘订单

### 执行层级（在代码中）

机器人根据交易规模使用不同的策略：

| 鲸鱼股数 | 价格缓冲 | 规模倍数 | 订单类型 |
|--------------|--------------|-----------------|------------|
| 4000+        | 0.01         | 1.25x           | FAK        |
| 2000-3999    | 0.01         | 1.0x            | FAK        |
| 1000-1999    | 0.00         | 1.0x            | FAK        |
| <1000        | 0.00         | 1.0x            | FAK        |

**修改：** 编辑 `src/config.rs` 中的 `EXECUTION_TIERS`（需要重新编译）。

---

## 5. 配置示例

### 5.1 示例 1：初学者（安全测试）

```env
PRIVATE_KEY=your_key_here
FUNDER_ADDRESS=your_address_here
TARGET_WHALE_ADDRESS=whale_address_here
ALCHEMY_API_KEY=your_api_key_here

# 安全第一
ENABLE_TRADING=false
MOCK_TRADING=true

# 默认熔断器设置（已经安全）
CB_LARGE_TRADE_SHARES=1500.0
CB_CONSECUTIVE_TRIGGER=2
CB_SEQUENCE_WINDOW_SECS=30
CB_MIN_DEPTH_USD=200.0
CB_TRIP_DURATION_SECS=120
```

### 5.2 示例 2：保守交易

```env
PRIVATE_KEY=your_key_here
FUNDER_ADDRESS=your_address_here
TARGET_WHALE_ADDRESS=whale_address_here
ALCHEMY_API_KEY=your_api_key_here

ENABLE_TRADING=true
MOCK_TRADING=false

# 更保守的熔断器
CB_LARGE_TRADE_SHARES=1000.0      # 检查更多交易
CB_CONSECUTIVE_TRIGGER=1          # 检查每个大额交易
CB_SEQUENCE_WINDOW_SECS=20        # 更快检测
CB_MIN_DEPTH_USD=500.0            # 仅流动性市场
CB_TRIP_DURATION_SECS=300         # 触发后等待 5 分钟
```

### 5.3 示例 3：激进交易

```env
PRIVATE_KEY=your_key_here
FUNDER_ADDRESS=your_address_here
TARGET_WHALE_ADDRESS=whale_address_here
ALCHEMY_API_KEY=your_api_key_here

ENABLE_TRADING=true
MOCK_TRADING=false

# 不太保守的熔断器
CB_LARGE_TRADE_SHARES=2000.0      # 仅检查非常大的交易
CB_CONSECUTIVE_TRIGGER=3          # 仅在 3+ 交易后检查
CB_SEQUENCE_WINDOW_SECS=60        # 更长窗口
CB_MIN_DEPTH_USD=100.0            # 允许较薄的市场
CB_TRIP_DURATION_SECS=60          # 快速恢复
```

---

## 6. 验证

编辑 `.env` 后，验证它：

```bash
cargo run --release --bin validate_setup
```

这检查：
- ✅ 所有必需字段都已设置
- ✅ 地址格式正确
- ✅ 布尔值有效
- ✅ 数值是有效数字
- ✅ 没有明显错误

---

## 7. 配置故障排除

**问题：** 机器人无法启动，显示"缺少必需的环境变量"
- **解决方案：** 检查 `.env` 中的所有必需字段是否已填写（没有"here"占位符）

**问题：** "无效地址格式"错误
- **解决方案：**
  - 私钥：必须恰好是 64 个十六进制字符，无 `0x`
  - 地址：必须恰好是 40 个十六进制字符（FUNDER_ADDRESS 可以有或没有 `0x`，TARGET_WHALE_ADDRESS 无 `0x`）

**问题：** "API 密钥无效"或连接错误
- **解决方案：**
  - 验证 API 密钥是否正确（仔细复制粘贴）
  - 检查您是否使用免费套餐限制
  - 尝试重新生成 API 密钥

**问题：** 熔断器阻止所有交易
- **解决方案：** 将 `CB_MIN_DEPTH_USD` 调低或将 `CB_CONSECUTIVE_TRIGGER` 调高

更多帮助，请参阅 [故障排除指南](06_故障排除.md)。
