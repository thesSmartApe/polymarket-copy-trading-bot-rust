# 故障排除指南

常见问题及其解决方案。

## 目录

1. [安装问题](#1-安装问题)
2. [配置问题](#2-配置问题)
3. [连接问题](#3-连接问题)
4. [交易问题](#4-交易问题)
5. [性能问题](#5-性能问题)
6. [一般错误](#6-一般错误)
7. [获取更多帮助](#7-获取更多帮助)
8. [预防提示](#8-预防提示)
9. [要避免的常见错误](#9-要避免的常见错误)

---

## 1. 安装问题

### "rustc: command not found"

**问题：** Rust 未安装或不在 PATH 中。

**解决方案：**
1. 从 https://rustup.rs/ 安装 Rust
2. 安装后重启终端/PowerShell
3. 验证：`rustc --version`

**Windows：** 安装后可能需要重启计算机。

---

### "cargo: command not found"

**问题：** 找不到 Cargo（Rust 包管理器）。

**解决方案：**
- Rust 安装应自动包含 cargo
- 如果缺失，重新安装 Rust
- 验证：`cargo --version`

---

### 构建错误："failed to fetch" 或网络错误

**问题：** 无法下载依赖项。

**解决方案：**
1. 检查互联网连接
2. 重试（可能是临时网络问题）
3. 如果在受限网络中，配置代理：
   ```bash
   # 设置 HTTP 代理
   export HTTP_PROXY=http://proxy:port
   export HTTPS_PROXY=http://proxy:port
   ```

---

### 构建时间过长

**问题：** 首次构建下载许多依赖项。

**解决方案：**
- 首次构建正常（5-15 分钟）
- 后续构建快得多
- 使用 `--release` 进行优化构建（编译较慢，运行较快）

---

## 2. 配置问题

### "PRIVATE_KEY env var is required"

**问题：** `.env` 文件中未设置私钥。

**解决方案：**
1. 检查 `.env` 文件是否存在
2. 验证 `PRIVATE_KEY=` 行是否存在
3. 确保值周围没有引号
4. 如果存在，删除任何 `0x` 前缀

**正确格式：**
```env
PRIVATE_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
```

---

### "FUNDER_ADDRESS env var is required"

**问题：** 未设置钱包地址。

**解决方案：**
1. 检查 `.env` 文件是否有 `FUNDER_ADDRESS=`
2. 确保它是您的钱包地址（40 个十六进制字符）
3. 可以包含或排除 `0x` 前缀

**正确格式：**
```env
FUNDER_ADDRESS=0x1234567890123456789012345678901234567890
# 或
FUNDER_ADDRESS=1234567890123456789012345678901234567890
```

---

### "TARGET_WHALE_ADDRESS env var is required"

**问题：** 未设置鲸鱼地址。

**解决方案：**
1. 在 `.env` 中设置 `TARGET_WHALE_ADDRESS=`
2. 必须是 40 个十六进制字符，**无 `0x` 前缀**
3. 从 Polymarket 排行榜或交易者个人资料获取地址

**正确格式：**
```env
TARGET_WHALE_ADDRESS=204f72f35326db932158cba6adff0b9a1da95e14
```

---

### "Set ALCHEMY_API_KEY or CHAINSTACK_API_KEY"

**问题：** 未设置 WebSocket 提供商 API 密钥。

**解决方案：**
1. 从 Alchemy（推荐）或 Chainstack 获取 API 密钥
2. 添加到 `.env`：
   ```env
   ALCHEMY_API_KEY=your_key_here
   ```
3. 或使用 Chainstack：
   ```env
   CHAINSTACK_API_KEY=your_key_here
   ```

**注意：** 您只需要一个，不需要两个。

---

### "Invalid address format"

**问题：** 地址格式错误。

**解决方案：**
- **私钥：** 必须恰好是 64 个十六进制字符，无 `0x`
- **FUNDER_ADDRESS：** 40 个十六进制字符（可以有 `0x`）
- **TARGET_WHALE_ADDRESS：** 40 个十六进制字符，**无 `0x`**

**检查：**
- 无额外空格
- 值周围无引号
- 正确长度
- 有效的十六进制字符（0-9, a-f）

---

## 3. 连接问题

### "WS error: connection failed"

**问题：** 无法连接到区块链 WebSocket。

**解决方案：**
1. **检查 API 密钥：**
   - 验证 API 密钥是否正确
   - 检查是否超过免费套餐限制
   - 尝试重新生成 API 密钥

2. **检查网络：**
   - 验证互联网连接
   - 尝试不同网络（移动热点测试）
   - 检查防火墙设置

3. **尝试不同提供商：**
   - 如果使用 Alchemy，尝试 Chainstack（反之亦然）
   - 某些提供商有地区限制

---

### "WS timeout" 错误

**问题：** WebSocket 连接超时。

**解决方案：**
1. **网络问题：**
   - 检查互联网稳定性
   - 尝试不同网络
   - 如需要，重启路由器

2. **API 提供商：**
   - 提供商可能有问题
   - 检查提供商状态页面
   - 尝试不同提供商

3. **防火墙/VPN：**
   - 暂时禁用 VPN
   - 检查防火墙是否允许 WebSocket 连接
   - 企业网络可能阻止 WebSocket

---

### 频繁重连

**问题：** 机器人不断断开和重连。

**解决方案：**
1. **网络稳定性：**
   - 如可能，使用有线连接
   - 检查网络质量
   - 重启路由器

2. **API 限制：**
   - 检查是否达到速率限制
   - 如需要，升级 API 计划
   - 使用不同提供商

3. **防火墙：**
   - 为机器人添加例外
   - 检查防病毒软件是否阻止

---

## 4. 交易问题

### "No trades being detected"

**问题：** 机器人运行但看不到任何鲸鱼交易。

**解决方案：**
1. **验证鲸鱼地址：**
   - 检查 `TARGET_WHALE_ADDRESS` 是否正确
   - 确认鲸鱼正在积极交易
   - 鲸鱼可能不活跃

2. **检查连接：**
   - 机器人应显示 "🔌 Connected. Subscribing..."
   - 如果没有，请参阅上面的连接问题

3. **等待更长时间：**
   - 鲸鱼不会持续交易
   - 可能需要几分钟/小时才能看到交易
   - 检查 CSV 日志文件是否有任何活动

4. **验证监控地址：**
   - 检查 Polymarket 合约地址是否已更改
   - 机器人可能需要更新

---

### "SKIPPED_SMALL" 消息

**问题：** 机器人跳过交易，因为它们太小。

**说明：** 这是正常的。机器人只复制高于最小阈值的交易（默认：10 股）。

**解决方案：** 如果您想复制较小的交易，修改 `src/config.rs` 中的 `MIN_WHALE_SHARES_TO_COPY`（需要重新编译）。

---

### "CB_BLOCKED" 消息

**问题：** 熔断器正在阻止交易。

**说明：** 这是一项安全功能。机器人检测到潜在危险条件（低流动性、快速交易等）。

**解决方案：**
1. **等待：** 熔断器在配置的持续时间后重置（默认：2 分钟）

2. **调整设置：** 如果阻止太多交易，调整熔断器设置：
   ```env
   CB_MIN_DEPTH_USD=100.0        # 更低 = 不太严格
   CB_CONSECUTIVE_TRIGGER=3      # 更高 = 不太严格
   CB_SEQUENCE_WINDOW_SECS=60    # 更长 = 不太严格
   ```

3. **检查市场：** 可能是真正的危险条件（低流动性、操纵）

---

### "EXEC_FAIL" 或订单失败

**问题：** 订单执行失败。

**解决方案：**
1. **资金不足：**
   - 检查钱包是否有足够的 USDC/USDC.e
   - 检查 gas（MATIC）费用
   - 建议最低：$50-100 USDC

2. **市场条件：**
   - 价格变动太快
   - 流动性不足
   - 市场关闭或暂停

3. **订单参数：**
   - 价格超出有效范围（0.01-0.99）
   - 规模太小或太大
   - 无效的代币 ID

4. **API 问题：**
   - Polymarket API 可能有问题
   - 检查 Polymarket 状态
   - 稍后重试

---

### "WORKER_TIMEOUT" 错误

**问题：** 订单处理时间过长。

**解决方案：**
1. **网络延迟：**
   - 检查互联网速度
   - 如可用，使用更近的 API 端点

2. **高负载：**
   - 同时发生许多交易
   - 系统可能很慢
   - 通常自行解决

3. **API 问题：**
   - Polymarket API 慢
   - 检查状态页面
   - 等待并重试

**注意：** 机器人会自动重试。一次超时通常不严重。

---

## 5. 性能问题

### CPU 使用率高

**问题：** 机器人使用太多 CPU。

**解决方案：**
1. **使用发布构建：**
   ```bash
   cargo run --release
   ```
   比调试构建快得多。

2. **关闭其他程序：**
   - 释放系统资源
   - 关闭不必要的应用程序

3. **系统资源：**
   - 检查系统是否满足最低要求
   - 可能需要更好的硬件

**注意：** 某些 CPU 使用是正常的，特别是在活跃交易期间。

---

### 内存使用率高

**问题：** 机器人使用太多 RAM。

**解决方案：**
1. **定期重启：**
   - 每天/每周重启机器人
   - 清除缓存

2. **检查内存泄漏：**
   - 随时间监控
   - 如果持续增长，请报告

3. **系统资源：**
   - 可能需要更多 RAM
   - 关闭其他程序

**正常使用：** 50-200 MB 是典型的。

---

### 订单执行缓慢

**问题：** 交易执行时间过长。

**解决方案：**
1. **使用发布构建：**
   ```bash
   cargo build --release
   cargo run --release
   ```

2. **网络：**
   - 使用更快的互联网
   - 有线连接优于 WiFi
   - 更靠近 API 服务器

3. **API 提供商：**
   - 尝试不同提供商
   - 付费套餐可能比免费更快

**注意：** 执行时间取决于区块链速度，而不仅仅是机器人速度。

---

## 6. 一般错误

### "File not found" 错误

**问题：** 机器人找不到必需的文件。

**解决方案：**
1. **检查当前目录：**
   - 从项目根目录运行机器人
   - 使用 `cd` 导航到正确的文件夹

2. **检查文件是否存在：**
   - `.env` 文件必须存在
   - `Cargo.toml` 应该存在
   - 验证您在正确的目录中

3. **文件权限：**
   - 确保您有读/写访问权限
   - 检查文件是否被另一个程序锁定

---

### CSV 文件错误

**问题：** 无法写入 CSV 日志文件。

**解决方案：**
1. **权限：**
   - 检查目录中的写入权限
   - 如需要，以管理员身份运行（Windows）

2. **文件锁定：**
   - 如果在 Excel/编辑器中打开，请关闭 CSV 文件
   - 另一个实例可能已打开它

3. **磁盘空间：**
   - 检查可用磁盘空间
   - 如需要，删除旧的 CSV 文件

---

### "Panic" 或崩溃错误

**问题：** 机器人意外崩溃。

**解决方案：**
1. **检查错误消息：**
   - 阅读完整错误输出
   - 查找特定错误原因

2. **检查配置：**
   - 验证所有 `.env` 值是否正确
   - 运行 `validate_setup` 二进制文件

3. **更新依赖项：**
   ```bash
   cargo update
   cargo build --release
   ```

4. **报告错误：**
   - 保存错误消息
   - 记录您在做什么
   - 检查 GitHub 问题或联系支持

---

### 奇怪的行为或意外结果

**问题：** 机器人行为不符合预期。

**解决方案：**
1. **检查配置：**
   - 查看 `.env` 设置
   - 对照 `.env.example` 验证
   - 运行配置检查器

2. **检查日志：**
   - 查看控制台输出
   - 检查 CSV 文件中的模式
   - 查找错误消息

3. **重置为默认值：**
   - 将 `.env.example` 复制到 `.env`
   - 仅填写必需值
   - 使用默认值测试

4. **阅读文档：**
   - 查看 [功能指南](04_功能说明.md)
   - 检查 [配置指南](03_配置指南.md)
   - 了解预期行为

---

## 7. 获取更多帮助

如果您已尝试这些解决方案但仍有问题：

1. **运行配置检查器：**
   ```bash
   cargo run --release --bin validate_setup
   ```

2. **检查日志：**
   - 查看控制台输出中的错误
   - 检查 `matches_optimized.csv` 中的模式

3. **收集信息：**
   - 错误消息（完整文本）
   - 配置（编辑私钥！）
   - 错误发生时您在做什么
   - 系统信息（操作系统、Rust 版本）

4. **搜索现有问题：**
   - 检查 GitHub 问题
   - 在线搜索错误消息

5. **寻求帮助：**
   - 创建详细的问题报告
   - 包含所有收集的信息
   - 具体说明问题

---

## 8. 预防提示

**运行前：**
- ✅ 首先在模拟模式下测试
- ✅ 使用检查器验证配置
- ✅ 从小额开始
- ✅ 了解机器人工作原理

**运行时：**
- ✅ 监控控制台输出
- ✅ 定期检查 CSV 日志
- ✅ 在 Polymarket 上验证仓位
- ✅ 保持机器人更新

**良好实践：**
- ✅ 为机器人使用单独的钱包
- ✅ 不要冒超过您能承受的风险
- ✅ 定期监控
- ✅ 保留配置备份
- ✅ 了解所涉及的风险

---

## 9. 要避免的常见错误

❌ **使用主钱包：** 为机器人使用单独的钱包  
❌ **错误的地址格式：** 仔细检查地址格式  
❌ **分享私钥：** 永远不要分享或提交私钥  
❌ **不测试就运行：** 始终首先在模拟模式下测试  
❌ **忽略错误：** 在继续之前解决错误  
❌ **设置过于激进：** 从保守开始，逐渐调整  
❌ **不监控：** 定期检查机器人和仓位  
❌ **资金不足：** 确保钱包有足够的余额  

---

更多帮助，请参阅：
- [设置指南](02_设置指南.md)
- [配置指南](03_配置指南.md)
- [功能指南](04_功能说明.md)
